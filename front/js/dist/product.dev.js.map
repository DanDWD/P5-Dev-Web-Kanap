{"version":3,"sources":["product.js"],"names":["getProductId","url","URL","window","location","href","params","URLSearchParams","search","has","id","get","alert","getProductData","productId","fetch","response","json","displayProducts","data","document","getElementById","textContent","name","price","description","querySelector","innerHTML","imageUrl","altTxt","colors","colorRender","forEach","item","htmlContentItem","addEventListener","e","addProductToCart","_id","color","value","quantity","errorMessage","selection","cart","JSON","parse","localStorage","getItem","setItem","stringify","some","y","duplicateIndex","findIndex","parseFloat","push"],"mappings":"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","sourcesContent":["//----recuperer l'id dans l'url\r\nfunction getProductId () {\r\n    //recuperer l'url\r\n    let url = new URL(window.location.href);\r\n    //recuperer les parametres dans l'url\r\n    let params = new URLSearchParams(url.search);\r\n    \r\n        //recuperation du parametre id\r\n        if (params.has('id')) {\r\n            let id = params.get('id');\r\n            return id;\r\n        }\r\n        else {\r\n            alert(\"Erreur : impossible de récupérer l'identifiant dans l'url\");\r\n        }\r\n    }\r\n    \r\n    //----retourner les caracteristiques des articles sur l'api\r\n    async function getProductData () {\r\n        const productId = getProductId ();\r\n        try {\r\n            let response = await fetch(`http://localhost:3000/api/products/${productId}`);\r\n            //convertion au format json    \r\n            return await response.json();\r\n            }\r\n        catch (e) {\r\n            alert(\"Erreur. L'API est injoinable\" + e );\r\n        }\r\n    };\r\n      \r\n    //----afficher le produit\r\n    (async function displayProducts() {\r\n        let data = await getProductData ();\r\n        document.getElementById('title').textContent = data.name;\r\n        document.getElementById('price').textContent = data.price;\r\n        document.getElementById('description').textContent = data.description;\r\n        document.querySelector('.item__img').innerHTML = `\r\n            <img src=\"${data.imageUrl}\" alt=\"${data.altTxt}\">\r\n        `;\r\n        //choix de la couleur\r\n        let colors = data.colors;\r\n        //rendu\r\n        let colorRender = '';\r\n        colors.forEach(item => {\r\n            let htmlContentItem = `\r\n                <option value=\"${item}\">${item}</option>\r\n            `;\r\n            //placer le rendu en memoire\r\n            colorRender = colorRender+htmlContentItem;\r\n        });\r\n        //injecter le rendu dans l'html \r\n        document.getElementById(\"colors\").innerHTML += colorRender;\r\n        document.getElementById(\"addToCart\").addEventListener(\"click\", (e) => {\r\n    \r\n            addProductToCart(data._id);\r\n        \r\n        })\r\n    })();\r\n\r\n//----ajouter le(s) produit(s) dans le panier\r\nfunction addProductToCart(id){\r\n    //recuperation de la couleur  \r\n    const color = document.querySelector(\"#colors\").value;\r\n    //recuperation de la quantité\r\n    const quantity = document.querySelector(\"#quantity\").value;\r\n    //possibles erreurs\r\n    let errorMessage = \"\";\r\n\r\n    if(!id){\r\n        errorMessage += \"il manque l'identifiant produit\\n\"\r\n    }\r\n\r\n    if (quantity < 1 || quantity > 100) {\r\n        errorMessage += \"Quantité non séléctionnée !\\n\";\r\n    }\r\n\r\n    if(color == \"\"){\r\n        errorMessage += \"Couleur non séléctionnée !\\n\";\r\n    }\r\n    \r\n    if(errorMessage !== \"\"){\r\n       alert(errorMessage);\r\n    }else{\r\n        \r\n        let selection = {\r\n            id,\r\n            color,\r\n            quantity,    \r\n        }\r\n        \r\n         //si la quantite enregistree est comprise entre 1 et 100\r\n         let cart = JSON.parse(localStorage.getItem(\"panier\"));\r\n    \r\n         //si le panier n'existe pas\r\n         if (cart == null) {\r\n             //on cree le panier et on le stock en localstorage\r\n             let cart = [selection];\r\n             localStorage.setItem(\"panier\", JSON.stringify(cart));\r\n\r\n         //tester si il y a un doublon dans le tableau\r\n         } else if (cart.some(y =>\r\n             y.id === selection.id &&\r\n             y.color === selection.color) == true) {\r\n                 //on prend son index\r\n                 const duplicateIndex = cart.findIndex(e =>\r\n                     e.id === selection.id &&\r\n                     e.color === selection.color);\r\n                 //addition de la valeur initiale du panier + la selection\r\n                 cart[duplicateIndex].quantity = parseFloat(cart[duplicateIndex].quantity) + parseFloat(selection.quantity);\r\n                 //mise a jour du panier en ls\r\n                 localStorage.setItem(\"panier\", JSON.stringify(cart));\r\n\r\n         //si l'element n'est pas dans un panier\r\n         } else {\r\n             //envoyer directement la selection au panier\r\n             cart.push(selection);\r\n             localStorage.setItem(\"panier\", JSON.stringify(cart));\r\n         };\r\n\r\n         alert(`${selection.quantity} article(s) ${selection.color} ajoute(s) dans le panier`);\r\n        }     \r\n}"],"file":"product.dev.js"}